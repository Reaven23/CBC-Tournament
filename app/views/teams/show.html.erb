<!-- Header Section -->
<section class="team-header <%= 'has-photo' if @team.photo.attached? %>">
  <div class="team-header-background">
    <% if @team.photo.attached? %>
      <%= cl_image_tag @team.photo.key, alt: @team.name, class: "team-logo-bg" %>
    <% end %>
    <div class="team-header-overlay"></div>
  </div>

  <!-- Navigation fixe en haut -->
  <div class="team-nav-fixed">
    <div class="container-fluid px-3">
      <div class="d-flex align-items-center justify-content-between">
        <%= link_to tournament_path(@tournament), class: "btn-back" do %>
          <i class="fas fa-arrow-left"></i>
          <span>Retour au tournoi</span>
        <% end %>

        <% if @team.pool %>
          <div class="pool-info">
            <i class="fas fa-layer-group"></i>
            <span><%= @team.pool.name %></span>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Team Info -->
  <div class="container-fluid px-3">
    <div class="row">
      <div class="col-12">
        <div class="team-info">
          <div class="team-logo-main">
            <% if @team.photo.attached? %>
              <%= cl_image_tag @team.photo.key, alt: @team.name, class: "team-photo" %>
            <% else %>
              <div class="team-photo-placeholder">
                <i class="fas fa-basketball-ball"></i>
              </div>
            <% end %>
          </div>

          <div class="team-details">
            <h1 class="team-title"><%= @team.name %></h1>
            <p class="team-tournament">
              <i class="fas fa-trophy"></i>
              <span><%= @tournament.name %></span>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Stats Section -->
<section class="team-stats">
  <div class="container-fluid px-3">
    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-value"><%= @stats[:total_games] %></div>
        <div class="stat-label">Matchs joués</div>
      </div>
      <div class="stat-item">
        <div class="stat-value text-success"><%= @stats[:wins] %></div>
        <div class="stat-label">Victoires</div>
      </div>
      <div class="stat-item">
        <div class="stat-value text-danger"><%= @stats[:losses] %></div>
        <div class="stat-label">Défaites</div>
      </div>
      <div class="stat-item">
        <div class="stat-value text-primary"><%= @stats[:points] %></div>
        <div class="stat-label">Points</div>
      </div>
      <div class="stat-item">
        <div class="stat-value text-info"><%= @stats[:goals_scored] %></div>
        <div class="stat-label">Points marqués</div>
      </div>
      <div class="stat-item">
        <div class="stat-value text-warning"><%= @stats[:goals_conceded] %></div>
        <div class="stat-label">Points encaissés</div>
      </div>
    </div>
  </div>
</section>

<!-- Navigation Tabs -->
<section class="team-nav">
  <div class="container-fluid px-3">
    <div class="nav nav-tabs team-tabs" role="tablist">
      <button class="nav-link active" id="all-games-tab" data-bs-toggle="tab" data-bs-target="#all-games" type="button" role="tab">
        <i class="fas fa-basketball-ball me-1"></i>
        Tous les matchs
      </button>
      <button class="nav-link" id="pool-games-tab" data-bs-toggle="tab" data-bs-target="#pool-games" type="button" role="tab">
        <i class="fas fa-layer-group me-1"></i>
        Matchs de poule
      </button>
      <button class="nav-link" id="knockout-games-tab" data-bs-toggle="tab" data-bs-target="#knockout-games" type="button" role="tab">
        <i class="fas fa-trophy me-1"></i>
        Phase finale
      </button>
    </div>
  </div>
</section>

<!-- Tab Content -->
<section class="team-content">
  <div class="container-fluid px-3">
    <div class="tab-content" id="teamTabContent">

      <!-- All Games Tab -->
      <div class="tab-pane fade show active" id="all-games" role="tabpanel">
        <% if @games.any? %>
          <div class="games-list">
            <% @games.each do |game| %>
              <div class="game-card">
                <div class="game-header">
                  <div class="game-info">
                    <span class="game-type">
                      <% if game.pool_game? %>
                        Match de poule
                      <% else %>
                        <%= case game.game_type
                            when 'quarter' then 'Quart de finale'
                            when 'semi' then 'Demi-finale'
                            when 'final' then 'Finale'
                            when 'third_place' then 'Petite finale'
                            else game.game_type.humanize
                            end %>
                      <% end %>
                    </span>
                    <% if game.pool %>
                      <span class="game-pool">
                        <i class="fas fa-layer-group me-1"></i>
                        <%= game.pool.name %>
                      </span>
                    <% end %>
                    <% if game.game_start? %>
                      <span class="game-time">
                        <i class="fas fa-clock me-1"></i>
                        <%= game.formatted_game_start %>
                      </span>
                    <% end %>
                    <% if game.court_number? %>
                      <span class="game-court">
                        <i class="fas fa-map-marker-alt me-1"></i>
                        Terrain <%= game.court_number %>
                      </span>
                    <% end %>
                  </div>
                  <div class="game-status">
                    <span class="badge status-<%= game.status %>">
                      <%= game.status == 'played' ? 'Terminé' : 'Programmé' %>
                    </span>
                  </div>
                </div>

                <div class="game-teams">
                  <div class="team team-home <%= 'winner' if game.winner == game.home_team %>">
                    <div class="team-name"><%= game.home_team.name %></div>
                    <div class="team-score"><%= game.home_score || '-' %></div>
                  </div>
                  <div class="vs">VS</div>
                  <div class="team team-away <%= 'winner' if game.winner == game.away_team %>">
                    <div class="team-name"><%= game.away_team.name %></div>
                    <div class="team-score"><%= game.away_score || '-' %></div>
                  </div>
                </div>

                <% if game.referees.any? %>
                  <div class="game-referees">
                    <i class="fas fa-whistle me-1"></i>
                    <span>Arbitres: <%= game.referees.map(&:name).join(', ') %></span>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="no-games">
            <i class="fas fa-basketball-ball fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">Aucun match</h4>
            <p class="text-muted">Cette équipe n'a pas encore de matchs programmés.</p>
          </div>
        <% end %>
      </div>

      <!-- Pool Games Tab -->
      <div class="tab-pane fade" id="pool-games" role="tabpanel">
        <% if @pool_games.any? %>
          <div class="games-list">
            <% @pool_games.each do |game| %>
              <div class="game-card">
                <div class="game-header">
                  <div class="game-info">
                    <span class="game-type">Match de poule</span>
                    <% if game.pool %>
                      <span class="game-pool">
                        <i class="fas fa-layer-group me-1"></i>
                        <%= game.pool.name %>
                      </span>
                    <% end %>
                    <% if game.game_start? %>
                      <span class="game-time">
                        <i class="fas fa-clock me-1"></i>
                        <%= game.formatted_game_start %>
                      </span>
                    <% end %>
                    <% if game.court_number? %>
                      <span class="game-court">
                        <i class="fas fa-map-marker-alt me-1"></i>
                        Terrain <%= game.court_number %>
                      </span>
                    <% end %>
                  </div>
                  <div class="game-status">
                    <span class="badge status-<%= game.status %>">
                      <%= game.status == 'played' ? 'Terminé' : 'Programmé' %>
                    </span>
                  </div>
                </div>

                <div class="game-teams">
                  <div class="team team-home <%= 'winner' if game.winner == game.home_team %>">
                    <div class="team-name"><%= game.home_team.name %></div>
                    <div class="team-score"><%= game.home_score || '-' %></div>
                  </div>
                  <div class="vs">VS</div>
                  <div class="team team-away <%= 'winner' if game.winner == game.away_team %>">
                    <div class="team-name"><%= game.away_team.name %></div>
                    <div class="team-score"><%= game.away_score || '-' %></div>
                  </div>
                </div>

                <% if game.referees.any? %>
                  <div class="game-referees">
                    <i class="fas fa-whistle me-1"></i>
                    <span>Arbitres: <%= game.referees.map(&:name).join(', ') %></span>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="no-games">
            <i class="fas fa-layer-group fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">Aucun match de poule</h4>
            <p class="text-muted">Cette équipe n'a pas encore de matchs de poule programmés.</p>
          </div>
        <% end %>
      </div>

      <!-- Knockout Games Tab -->
      <div class="tab-pane fade" id="knockout-games" role="tabpanel">
        <% if @knockout_games.any? %>
          <div class="games-list">
            <% @knockout_games.each do |game| %>
              <div class="game-card knockout-game">
                <div class="game-header">
                  <div class="game-info">
                    <span class="game-type">
                      <%= case game.game_type
                          when 'quarter' then 'Quart de finale'
                          when 'semi' then 'Demi-finale'
                          when 'final' then 'Finale'
                          when 'third_place' then 'Petite finale'
                          else game.game_type.humanize
                          end %>
                    </span>
                    <% if game.game_start? %>
                      <span class="game-time">
                        <i class="fas fa-clock me-1"></i>
                        <%= game.formatted_game_start %>
                      </span>
                    <% end %>
                    <% if game.court_number? %>
                      <span class="game-court">
                        <i class="fas fa-map-marker-alt me-1"></i>
                        Terrain <%= game.court_number %>
                      </span>
                    <% end %>
                  </div>
                  <div class="game-status">
                    <span class="badge status-<%= game.status %>">
                      <%= game.status == 'played' ? 'Terminé' : 'Programmé' %>
                    </span>
                  </div>
                </div>

                <div class="game-teams">
                  <div class="team team-home <%= 'winner' if game.winner == game.home_team %>">
                    <div class="team-name"><%= game.home_team.name %></div>
                    <div class="team-score"><%= game.home_score || '-' %></div>
                  </div>
                  <div class="vs">VS</div>
                  <div class="team team-away <%= 'winner' if game.winner == game.away_team %>">
                    <div class="team-name"><%= game.away_team.name %></div>
                    <div class="team-score"><%= game.away_score || '-' %></div>
                  </div>
                </div>

                <% if game.referees.any? %>
                  <div class="game-referees">
                    <i class="fas fa-whistle me-1"></i>
                    <span>Arbitres: <%= game.referees.map(&:name).join(', ') %></span>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="no-games">
            <i class="fas fa-trophy fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">Aucun match de phase finale</h4>
            <p class="text-muted">Cette équipe n'a pas encore de matchs de phase finale programmés.</p>
          </div>
        <% end %>
      </div>

    </div>
  </div>
</section>
