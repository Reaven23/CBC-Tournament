<!-- Header Section -->
<section class="tournament-header">
  <div class="container-fluid px-3">
    <div class="row">
      <div class="col-12">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <%= link_to tournaments_path, class: "btn btn-outline-light btn-sm" do %>
            <i class="fas fa-arrow-left me-1"></i>
            Retour
          <% end %>
          <span class="badge tournament-status <%= @tournament.status %>">
            <%= @tournament.status.humanize %>
          </span>
        </div>

        <h1 class="tournament-title mb-2"><%= @tournament.name %></h1>

        <div class="tournament-meta">
          <div class="meta-item">
            <i class="fas fa-calendar-alt me-1"></i>
            <%= @tournament.start_date&.strftime("%d/%m/%Y") %> - <%= @tournament.end_date&.strftime("%d/%m/%Y") %>
          </div>
          <div class="meta-item">
            <i class="fas fa-users me-1"></i>
            <%= @tournament.teams.count %> équipes
          </div>
          <div class="meta-item">
            <i class="fas fa-trophy me-1"></i>
            <%= @tournament.pools.count %> poules
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Navigation Tabs -->
<section class="tournament-nav">
  <div class="container-fluid px-3">
    <div class="nav nav-tabs tournament-tabs" role="tablist">
      <button class="nav-link active" id="teams-tab" data-bs-toggle="tab" data-bs-target="#teams" type="button" role="tab">
        <i class="fas fa-users me-1"></i>
        Équipes
      </button>
      <button class="nav-link" id="matches-tab" data-bs-toggle="tab" data-bs-target="#matches" type="button" role="tab">
        <i class="fas fa-basketball-ball me-1"></i>
        Matchs
      </button>
      <button class="nav-link" id="standings-tab" data-bs-toggle="tab" data-bs-target="#standings" type="button" role="tab">
        <i class="fas fa-list-ol me-1"></i>
        Classements
      </button>
    </div>
  </div>
</section>

<!-- Tab Content -->
<section class="tournament-content">
  <div class="container-fluid px-3">
    <div class="tab-content" id="tournamentTabContent">

      <!-- Teams Tab -->
      <div class="tab-pane fade show active" id="teams" role="tabpanel">
        <% if @tournament.teams.any? %>
          <div class="teams-list">
            <% @tournament.teams.includes(:pool).each do |team| %>
              <%= link_to tournament_team_path(@tournament, team), class: "team-row" do %>
                <div class="team-logo">
                  <% if team.photo.attached? %>
                    <%= image_tag team.photo, alt: team.name, class: "team-photo" %>
                  <% else %>
                    <div class="team-photo-placeholder">
                      <i class="fas fa-basketball-ball"></i>
                    </div>
                  <% end %>
                </div>
                <div class="team-info">
                  <div class="team-name"><%= team.name %></div>
                  <% if team.pool %>
                    <div class="team-pool"><%= team.pool.name %></div>
                  <% end %>
                </div>
                <div class="team-arrow">
                  <i class="fas fa-chevron-right"></i>
                </div>
              <% end %>
            <% end %>
          </div>
        <% else %>
          <div class="no-teams">
            <i class="fas fa-users fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">Aucune équipe</h4>
            <p class="text-muted">Les équipes seront bientôt ajoutées au tournoi.</p>
          </div>
        <% end %>
      </div>

      <!-- Matches Tab -->
      <div class="tab-pane fade" id="matches" role="tabpanel">
        <!-- Match Sub-navigation -->
        <div class="match-sub-nav mb-3">
          <div class="nav nav-pills match-sub-tabs" role="tablist">
            <button class="nav-link active" id="pool-matches-tab" data-bs-toggle="tab" data-bs-target="#pool-matches" type="button" role="tab">
              <i class="fas fa-layer-group me-1"></i>
              Poules
            </button>
            <button class="nav-link" id="quarter-matches-tab" data-bs-toggle="tab" data-bs-target="#quarter-matches" type="button" role="tab">
              <i class="fas fa-trophy me-1"></i>
              Quarts
            </button>
            <button class="nav-link" id="semi-matches-tab" data-bs-toggle="tab" data-bs-target="#semi-matches" type="button" role="tab">
              <i class="fas fa-medal me-1"></i>
              Demis
            </button>
            <button class="nav-link" id="final-matches-tab" data-bs-toggle="tab" data-bs-target="#final-matches" type="button" role="tab">
              <i class="fas fa-crown me-1"></i>
              Finale
            </button>
          </div>
        </div>

        <!-- Match Sub-content -->
        <div class="tab-content" id="matchTabContent">
          <!-- Pool Matches -->
          <div class="tab-pane fade show active" id="pool-matches" role="tabpanel">

            <!-- Pool Games -->
            <% if @games_by_pool.any? %>
              <% @games_by_pool.each do |pool, games| %>
                <div class="pool-section mb-4">
                  <h3 class="pool-title">
                    <i class="fas fa-layer-group me-2"></i>
                    <%= pool.name %>
                  </h3>

                  <div class="games-list">
                    <% games.each do |game| %>
                      <div class="game-card">
                        <div class="game-header">
                          <div class="game-info">
                            <span class="game-type">Match de poule</span>
                            <% if game.game_start? %>
                              <span class="game-time">
                                <i class="fas fa-clock me-1"></i>
                                <%= game.formatted_game_start %>
                              </span>
                            <% end %>
                            <% if game.court_number? %>
                              <span class="game-court">
                                <i class="fas fa-map-marker-alt me-1"></i>
                                Terrain <%= game.court_number %>
                              </span>
                            <% end %>
                          </div>
                          <div class="game-status">
                            <span class="badge status-<%= game.status %>">
                              <%= game.status == 'played' ? 'Terminé' : 'Programmé' %>
                            </span>
                          </div>
                        </div>

                        <div class="game-teams">
                          <div class="team team-home <%= 'winner' if game.winner == game.home_team %>">
                            <div class="team-name"><%= game.home_team.name %></div>
                            <div class="team-score"><%= game.home_score || '-' %></div>
                          </div>
                          <div class="vs">VS</div>
                          <div class="team team-away <%= 'winner' if game.winner == game.away_team %>">
                            <div class="team-name"><%= game.away_team.name %></div>
                            <div class="team-score"><%= game.away_score || '-' %></div>
                          </div>
                        </div>

                        <% if game.referees.any? %>
                          <div class="game-referees">
                            <i class="fas fa-whistle me-1"></i>
                            <span>Arbitres: <%= game.referees.map(&:name).join(', ') %></span>
                          </div>
                        <% end %>
                      </div>
                    <% end %>
                  </div>
                </div>
              <% end %>
            <% else %>
              <div class="no-games">
                <i class="fas fa-layer-group fa-3x text-muted mb-3"></i>
                <h4 class="text-muted">Aucun match de poule</h4>
                <p class="text-muted">Les matchs de poule seront bientôt disponibles.</p>
              </div>
            <% end %>
          </div>

          <!-- Quarter Matches -->
          <div class="tab-pane fade" id="quarter-matches" role="tabpanel">
            <% quarter_games = @knockout_games.where(game_type: 'quarter') %>
            <% if quarter_games.any? %>
              <div class="games-list">
                <% quarter_games.each do |game| %>
                  <div class="game-card knockout-game">
                    <div class="game-header">
                      <div class="game-info">
                        <span class="game-type">Quart de finale</span>
                        <% if game.game_start? %>
                          <span class="game-time">
                            <i class="fas fa-clock me-1"></i>
                            <%= game.formatted_game_start %>
                          </span>
                        <% end %>
                        <% if game.court_number? %>
                          <span class="game-court">
                            <i class="fas fa-map-marker-alt me-1"></i>
                            Terrain <%= game.court_number %>
                          </span>
                        <% end %>
                      </div>
                      <div class="game-status">
                        <span class="badge status-<%= game.status %>">
                          <%= game.status == 'played' ? 'Terminé' : 'Programmé' %>
                        </span>
                      </div>
                    </div>

                    <div class="game-teams">
                      <div class="team team-home <%= 'winner' if game.winner == game.home_team %>">
                        <div class="team-name"><%= game.home_team.name %></div>
                        <div class="team-score"><%= game.home_score || '-' %></div>
                      </div>
                      <div class="vs">VS</div>
                      <div class="team team-away <%= 'winner' if game.winner == game.away_team %>">
                        <div class="team-name"><%= game.away_team.name %></div>
                        <div class="team-score"><%= game.away_score || '-' %></div>
                      </div>
                    </div>

                    <% if game.referees.any? %>
                      <div class="game-referees">
                        <i class="fas fa-whistle me-1"></i>
                        <span>Arbitres: <%= game.referees.map(&:name).join(', ') %></span>
                      </div>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% else %>
              <div class="no-games">
                <i class="fas fa-trophy fa-3x text-muted mb-3"></i>
                <h4 class="text-muted">Aucun quart de finale</h4>
                <p class="text-muted">Les quarts de finale seront générés après la phase de poule.</p>
              </div>
            <% end %>
          </div>

          <!-- Semi Matches -->
          <div class="tab-pane fade" id="semi-matches" role="tabpanel">
            <% semi_games = @knockout_games.where(game_type: 'semi') %>
            <% if semi_games.any? %>
              <div class="games-list">
                <% semi_games.each do |game| %>
                  <div class="game-card knockout-game">
                    <div class="game-header">
                      <div class="game-info">
                        <span class="game-type">Demi-finale</span>
                        <% if game.game_start? %>
                          <span class="game-time">
                            <i class="fas fa-clock me-1"></i>
                            <%= game.formatted_game_start %>
                          </span>
                        <% end %>
                        <% if game.court_number? %>
                          <span class="game-court">
                            <i class="fas fa-map-marker-alt me-1"></i>
                            Terrain <%= game.court_number %>
                          </span>
                        <% end %>
                      </div>
                      <div class="game-status">
                        <span class="badge status-<%= game.status %>">
                          <%= game.status == 'played' ? 'Terminé' : 'Programmé' %>
                        </span>
                      </div>
                    </div>

                    <div class="game-teams">
                      <div class="team team-home <%= 'winner' if game.winner == game.home_team %>">
                        <div class="team-name"><%= game.home_team.name %></div>
                        <div class="team-score"><%= game.home_score || '-' %></div>
                      </div>
                      <div class="vs">VS</div>
                      <div class="team team-away <%= 'winner' if game.winner == game.away_team %>">
                        <div class="team-name"><%= game.away_team.name %></div>
                        <div class="team-score"><%= game.away_score || '-' %></div>
                      </div>
                    </div>

                    <% if game.referees.any? %>
                      <div class="game-referees">
                        <i class="fas fa-whistle me-1"></i>
                        <span>Arbitres: <%= game.referees.map(&:name).join(', ') %></span>
                      </div>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% else %>
              <div class="no-games">
                <i class="fas fa-medal fa-3x text-muted mb-3"></i>
                <h4 class="text-muted">Aucune demi-finale</h4>
                <p class="text-muted">Les demi-finales seront générées après les quarts de finale.</p>
              </div>
            <% end %>
          </div>

          <!-- Final Matches -->
          <div class="tab-pane fade" id="final-matches" role="tabpanel">
            <% final_games = @knockout_games.where(game_type: ['final', 'third_place']) %>
            <% if final_games.any? %>
              <div class="games-list">
                <% final_games.each do |game| %>
                  <div class="game-card knockout-game">
                    <div class="game-header">
                      <div class="game-info">
                        <span class="game-type">
                          <%= game.game_type == 'final' ? 'Finale' : 'Petite finale' %>
                        </span>
                        <% if game.game_start? %>
                          <span class="game-time">
                            <i class="fas fa-clock me-1"></i>
                            <%= game.formatted_game_start %>
                          </span>
                        <% end %>
                        <% if game.court_number? %>
                          <span class="game-court">
                            <i class="fas fa-map-marker-alt me-1"></i>
                            Terrain <%= game.court_number %>
                          </span>
                        <% end %>
                      </div>
                      <div class="game-status">
                        <span class="badge status-<%= game.status %>">
                          <%= game.status == 'played' ? 'Terminé' : 'Programmé' %>
                        </span>
                      </div>
                    </div>

                    <div class="game-teams">
                      <div class="team team-home <%= 'winner' if game.winner == game.home_team %>">
                        <div class="team-name"><%= game.home_team.name %></div>
                        <div class="team-score"><%= game.home_score || '-' %></div>
                      </div>
                      <div class="vs">VS</div>
                      <div class="team team-away <%= 'winner' if game.winner == game.away_team %>">
                        <div class="team-name"><%= game.away_team.name %></div>
                        <div class="team-score"><%= game.away_score || '-' %></div>
                      </div>
                    </div>

                    <% if game.referees.any? %>
                      <div class="game-referees">
                        <i class="fas fa-whistle me-1"></i>
                        <span>Arbitres: <%= game.referees.map(&:name).join(', ') %></span>
                      </div>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% else %>
              <div class="no-games">
                <i class="fas fa-crown fa-3x text-muted mb-3"></i>
                <h4 class="text-muted">Aucune finale</h4>
                <p class="text-muted">Les finales seront générées après les demi-finales.</p>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Standings Tab -->
      <div class="tab-pane fade" id="standings" role="tabpanel">
        <% if @pool_standings.any? %>
          <% @pool_standings.each do |pool, standings| %>
            <div class="standings-section mb-4">
              <h3 class="standings-title">
                <i class="fas fa-list-ol me-2"></i>
                <%= pool.name %>
              </h3>

              <div class="standings-table">
                <div class="standings-header">
                  <div class="pos">#</div>
                  <div class="team">Équipe</div>
                  <div class="stats">MJ</div>
                  <div class="stats">V</div>
                  <div class="stats">D</div>
                  <div class="stats">Pts</div>
                  <div class="stats">+/-</div>
                </div>

                <% standings.each_with_index do |team, index| %>
                  <div class="standings-row">
                    <div class="pos"><%= index + 1 %></div>
                    <div class="team">
                      <%= link_to tournament_team_path(@tournament, team), class: "team-link" do %>
                        <%= team.name %>
                      <% end %>
                    </div>
                    <div class="stats"><%= team.total_games %></div>
                    <div class="stats"><%= team.wins %></div>
                    <div class="stats"><%= team.losses %></div>
                    <div class="stats"><%= team.points %></div>
                    <div class="stats">
                      <span class="<%= team.goal_difference >= 0 ? 'text-success' : 'text-danger' %>">
                        <%= team.goal_difference >= 0 ? '+' : '' %><%= team.goal_difference %>
                      </span>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        <% else %>
          <div class="no-standings">
            <i class="fas fa-list-ol fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">Aucun classement disponible</h4>
            <p class="text-muted">Les classements seront disponibles une fois les matchs commencés.</p>
          </div>
        <% end %>
      </div>

    </div>
  </div>
</section>
